"use strict";
function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
const log4js = require("log4js");
const fs = require("fs");
const util = require("util");
const funcs = {
    'env': doEnv,
    'args': doArgs,
    'opts': doOpts
};
function getLogger(categoryName) {
    let args = arguments;
    let prefix = "";
    for (let i = 1; i < args.length; i++) {
        if (i !== args.length - 1)
            prefix = prefix + args[i] + "] [";
        else
            prefix = prefix + args[i];
    }
    if (typeof categoryName === 'string') {
        // category name is __filename then cut the prefix path
        categoryName = categoryName.replace(process.cwd(), '');
    }
    let logger = log4js.getLogger(categoryName);
    let pLogger = {};
    for (let key in logger) {
        pLogger[key] = logger[key];
    }
    ['log', 'debug', 'info', 'warn', 'error', 'trace', 'fatal'].forEach(function (item) {
        pLogger[item] = function () {
            let p = "";
            if (!process.env.RAW_MESSAGE) {
                if (args.length > 1) {
                    p = "[" + prefix + "] ";
                }
                if (args.length && process.env.LOGGER_LINE) {
                    p = getLine() + ": " + p;
                }
                p = colorize(p, colours[item]);
            }
            if (args.length) {
                arguments[0] = p + arguments[0];
            }
            logger[item].apply(logger, arguments);
        };
    });
    return pLogger;
}
exports.getLogger = getLogger;
;
let configState = {};
function initReloadConfiguration(filename, reloadSecs) {
    if (configState.timerId) {
        clearInterval(configState.timerId);
        delete configState.timerId;
    }
    configState.filename = filename;
    configState.lastMTime = getMTime(filename);
    configState.timerId = setInterval(reloadConfiguration, reloadSecs * 1000);
}
;
function getMTime(filename) {
    let mtime;
    try {
        mtime = fs.statSync(filename).mtime;
    }
    catch (e) {
        throw new Error("Cannot find file with given path: " + filename);
    }
    return mtime;
}
;
function loadConfigurationFile(filename) {
    if (filename) {
        return JSON.parse(fs.readFileSync(filename, "utf8"));
    }
    return undefined;
}
;
function reloadConfiguration() {
    let mtime = getMTime(configState.filename);
    if (!mtime) {
        return;
    }
    if (configState.lastMTime && (mtime.getTime() > configState.lastMTime.getTime())) {
        configureOnceOff(loadConfigurationFile(configState.filename));
    }
    configState.lastMTime = mtime;
}
;
function configureOnceOff(config) {
    if (config) {
        try {
            configureLevels(config.levels);
            if (config.replaceConsole) {
                log4js.replaceConsole();
            }
            else {
                log4js.restoreConsole();
            }
        }
        catch (e) {
            throw new Error("Problem reading log4js config " + util.inspect(config) +
                ". Error was \"" + e.message + "\" (" + e.stack + ")");
        }
    }
}
;
function configureLevels(levels) {
    if (levels) {
        for (let category in levels) {
            if (levels.hasOwnProperty(category)) {
                log4js.getLogger(category).setLevel(levels[category]);
            }
        }
    }
}
;
/**
 * Configure the logger.
 * Configure file just like log4js.json. And support ${scope:arg-name} format property setting.
 * It can replace the placeholder in runtime.
 * scope can be:
 *     env: environment variables, such as: env:PATH
 *     args: command line arguments, such as: args:1
 *     opts: key/value from opts argument of configure function
 *
 * @param  {String|Object} config configure file name or configure object
 * @param  {Object} opts   options
 * @return {Void}
 */
function configure(config, opts) {
    let filename = config;
    config = config || process.env.LOG4JS_CONFIG;
    opts = opts || {};
    if (typeof config === 'string') {
        config = JSON.parse(fs.readFileSync(config, "utf8"));
    }
    if (config) {
        config = replaceProperties(config, opts);
    }
    if (config && config.lineDebug) {
        process.env.LOGGER_LINE = true;
    }
    if (config && config.rawMessage) {
        process.env.RAW_MESSAGE = true;
    }
    if (filename && config && config.reloadSecs) {
        initReloadConfiguration(filename, config.reloadSecs);
    }
    // config object could not turn on the auto reload configure file in log4js
    log4js.configure(config, opts);
}
exports.configure = configure;
;
function replaceProperties(configObj, opts) {
    if (configObj instanceof Array) {
        for (let i = 0, l = configObj.length; i < l; i++) {
            configObj[i] = replaceProperties(configObj[i], opts);
        }
    }
    else if (typeof configObj === 'object') {
        let field;
        for (let f in configObj) {
            if (!configObj.hasOwnProperty(f)) {
                continue;
            }
            field = configObj[f];
            if (typeof field === 'string') {
                configObj[f] = doReplace(field, opts);
            }
            else if (typeof field === 'object') {
                configObj[f] = replaceProperties(field, opts);
            }
        }
    }
    return configObj;
}
function doReplace(src, opts) {
    if (!src) {
        return src;
    }
    let ptn = /\$\{(.*?)\}/g;
    let m, pro, ts, scope, name, defaultValue, func, res = '', lastIndex = 0;
    while ((m = ptn.exec(src))) {
        pro = m[1];
        ts = pro.split(':');
        if (ts.length !== 2 && ts.length !== 3) {
            res += pro;
            continue;
        }
        scope = ts[0];
        name = ts[1];
        if (ts.length === 3) {
            defaultValue = ts[2];
        }
        func = funcs[scope];
        if (!func && typeof func !== 'function') {
            res += pro;
            continue;
        }
        res += src.substring(lastIndex, m.index);
        lastIndex = ptn.lastIndex;
        res += (func(name, opts) || defaultValue);
    }
    if (lastIndex < src.length) {
        res += src.substring(lastIndex);
    }
    return res;
}
function doEnv(name) {
    return process.env[name];
}
function doArgs(name) {
    return process.argv[name];
}
function doOpts(name, opts) {
    return opts ? opts[name] : undefined;
}
function getLine() {
    let e = new Error();
    // now magic will happen: get line number from callstack
    if (process.platform === "win32") {
        return e.stack.split('\n')[3].split(':')[2];
    }
    return e.stack.split('\n')[3].split(':')[1];
}
function colorizeStart(style) {
    return style ? '\x1B[' + styles[style][0] + 'm' : '';
}
function colorizeEnd(style) {
    return style ? '\x1B[' + styles[style][1] + 'm' : '';
}
/**
 * Taken from masylum's fork (https://github.com/masylum/log4js-node)
 */
function colorize(str, style) {
    return colorizeStart(style) + str + colorizeEnd(style);
}
let styles = {
    //styles
    'bold': [1, 22],
    'italic': [3, 23],
    'underline': [4, 24],
    'inverse': [7, 27],
    //grayscale
    'white': [37, 39],
    'grey': [90, 39],
    'black': [90, 39],
    //colors
    'blue': [34, 39],
    'cyan': [36, 39],
    'green': [32, 39],
    'magenta': [35, 39],
    'red': [31, 39],
    'yellow': [33, 39]
};
let colours = {
    'all': "grey",
    'trace': "blue",
    'debug': "cyan",
    'info': "green",
    'warn': "yellow",
    'error': "red",
    'fatal': "magenta",
    'off': "grey"
};
__export(require("log4js"));
/*
module.exports = {
    getLogger: getLogger,
    getDefaultLogger: log4js.getDefaultLogger,

    addAppender: log4js.addAppender,
    loadAppender: log4js.loadAppender,
    clearAppenders: log4js.clearAppenders,
    configure: configure,

    replaceConsole: log4js.replaceConsole,
    restoreConsole: log4js.restoreConsole,

    levels: log4js.levels,
    setGlobalLogLevel: log4js.setGlobalLogLevel,

    layouts: log4js.layouts,
    appenders: log4js.appenders
};
*/ 
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsaUNBQWtDO0FBQ2xDLHlCQUEwQjtBQUMxQiw2QkFBOEI7QUFFOUIsTUFBTSxLQUFLLEdBQUc7SUFDYixLQUFLLEVBQUUsS0FBSztJQUNaLE1BQU0sRUFBRSxNQUFNO0lBQ2QsTUFBTSxFQUFFLE1BQU07Q0FDZCxDQUFDO0FBRUYsbUJBQTBCLFlBQW1CO0lBQzVDLElBQUksSUFBSSxHQUFHLFNBQVMsQ0FBQztJQUNyQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDaEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNuQyxJQUFJO1lBQ0gsTUFBTSxHQUFHLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFDLE9BQU8sWUFBWSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDdEMsdURBQXVEO1FBQ3ZELFlBQVksR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBQ0QsSUFBSSxNQUFNLEdBQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNoRCxJQUFJLE9BQU8sR0FBTyxFQUFFLENBQUM7SUFDckIsR0FBRyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN4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QUUsQ0FBQztJQUNqQixXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ3BCLFNBQVMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7SUFDbEIsV0FBVztJQUNYLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDakIsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNoQixPQUFPLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ2pCLFFBQVE7SUFDUixNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ2hCLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDaEIsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNqQixTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ25CLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDZixRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0NBQ2xCLENBQUM7QUFFRixJQUFJLE9BQU8sR0FBRztJQUNiLEtBQUssRUFBRSxNQUFNO0lBQ2IsT0FBTyxFQUFFLE1BQU07SUFDZixPQUFPLEVBQUUsTUFBTTtJQUNmLE1BQU0sRUFBRSxPQUFPO0lBQ2YsTUFBTSxFQUFFLFFBQVE7SUFDaEIsT0FBTyxFQUFFLEtBQUs7SUFDZCxPQUFPLEVBQUUsU0FBUztJQUNsQixLQUFLLEVBQUUsTUFBTTtDQUNiLENBQUM7QUFFRiw0QkFBdUI7QUFFdkI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7RUFtQkUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nNGpzID0gcmVxdWlyZSgnbG9nNGpzJyk7XHJcbmltcG9ydCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbmltcG9ydCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xyXG5cclxuY29uc3QgZnVuY3MgPSB7XHJcblx0J2Vudic6IGRvRW52LFxyXG5cdCdhcmdzJzogZG9BcmdzLFxyXG5cdCdvcHRzJzogZG9PcHRzXHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TG9nZ2VyKGNhdGVnb3J5TmFtZTpzdHJpbmcpIHtcclxuXHRsZXQgYXJncyA9IGFyZ3VtZW50cztcclxuXHRsZXQgcHJlZml4ID0gXCJcIjtcclxuXHRmb3IgKGxldCBpID0gMTsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdGlmIChpICE9PSBhcmdzLmxlbmd0aCAtIDEpXHJcblx0XHRcdHByZWZpeCA9IHByZWZpeCArIGFyZ3NbaV0gKyBcIl0gW1wiO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHRwcmVmaXggPSBwcmVmaXggKyBhcmdzW2ldO1xyXG5cdH1cclxuXHRpZiAodHlwZW9mIGNhdGVnb3J5TmFtZSA9PT0gJ3N0cmluZycpIHtcclxuXHRcdC8vIGNhdGVnb3J5IG5hbWUgaXMgX19maWxlbmFtZSB0aGVuIGN1dCB0aGUgcHJlZml4IHBhdGhcclxuXHRcdGNhdGVnb3J5TmFtZSA9IGNhdGVnb3J5TmFtZS5yZXBsYWNlKHByb2Nlc3MuY3dkKCksICcnKTtcclxuXHR9XHJcblx0bGV0IGxvZ2dlcjphbnkgPSBsb2c0anMuZ2V0TG9nZ2VyKGNhdGVnb3J5TmFtZSk7XHJcblx0bGV0IHBMb2dnZXI6YW55ID0ge307XHJcblx0Zm9yIChsZXQga2V5IGluIGxvZ2dlcikge1xyXG5cdFx0cExvZ2dlcltrZXldID0gbG9nZ2VyW2tleV07XHJcblx0fVxyXG5cclxuXHRbJ2xvZycsICdkZWJ1ZycsICdpbmZvJywgJ3dhcm4nLCAnZXJyb3InLCAndHJhY2UnLCAnZmF0YWwnXS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdHBMb2dnZXJbaXRlbV0gPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0bGV0IHAgPSBcIlwiO1xyXG5cdFx0XHRpZiAoIXByb2Nlc3MuZW52LlJBV19NRVNTQUdFKSB7XHJcblx0XHRcdFx0aWYgKGFyZ3MubGVuZ3RoID4gMSkge1xyXG5cdFx0XHRcdFx0cCA9IFwiW1wiICsgcHJlZml4ICsgXCJdIFwiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoYXJncy5sZW5ndGggJiYgcHJvY2Vzcy5lbnYuTE9HR0VSX0xJTkUpIHtcclxuXHRcdFx0XHRcdHAgPSBnZXRMaW5lKCkgKyBcIjogXCIgKyBwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRwID0gY29sb3JpemUocCwgKDxhbnk+Y29sb3VycylbaXRlbV0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoYXJncy5sZW5ndGgpIHtcclxuXHRcdFx0XHRhcmd1bWVudHNbMF0gPSBwICsgYXJndW1lbnRzWzBdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGxvZ2dlcltpdGVtXS5hcHBseShsb2dnZXIsIGFyZ3VtZW50cyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblx0cmV0dXJuIHBMb2dnZXI7XHJcbn07XHJcblxyXG5sZXQgY29uZmlnU3RhdGU6YW55ID0ge307XHJcblxyXG5mdW5jdGlvbiBpbml0UmVsb2FkQ29uZmlndXJhdGlvbihmaWxlbmFtZTpzdHJpbmcsIHJlbG9hZFNlY3M6bnVtYmVyKSB7XHJcblx0aWYgKGNvbmZpZ1N0YXRlLnRpbWVySWQpIHtcclxuXHRcdGNsZWFySW50ZXJ2YWwoY29uZmlnU3RhdGUudGltZXJJZCk7XHJcblx0XHRkZWxldGUgY29uZmlnU3RhdGUudGltZXJJZDtcclxuXHR9XHJcblx0Y29uZmlnU3RhdGUuZmlsZW5hbWUgPSBmaWxlbmFtZTtcclxuXHRjb25maWdTdGF0ZS5sYXN0TVRpbWUgPSBnZXRNVGltZShmaWxlbmFtZSk7XHJcblx0Y29uZmlnU3RhdGUudGltZXJJZCA9IHNldEludGVydmFsKHJlbG9hZENvbmZpZ3VyYXRpb24sIHJlbG9hZFNlY3MgKiAxMDAwKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldE1UaW1lKGZpbGVuYW1lOnN0cmluZykge1xyXG5cdGxldCBtdGltZTtcclxuXHR0cnkge1xyXG5cdFx0bXRpbWUgPSBmcy5zdGF0U3luYyhmaWxlbmFtZSkubXRpbWU7XHJcblx0fSBjYXRjaCAoZSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgZmlsZSB3aXRoIGdpdmVuIHBhdGg6IFwiICsgZmlsZW5hbWUpO1xyXG5cdH1cclxuXHRyZXR1cm4gbXRpbWU7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBsb2FkQ29uZmlndXJhdGlvbkZpbGUoZmlsZW5hbWU6c3RyaW5nKSB7XHJcblx0aWYgKGZpbGVuYW1lKSB7XHJcblx0XHRyZXR1cm4gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoZmlsZW5hbWUsIFwidXRmOFwiKSk7XHJcblx0fVxyXG5cdHJldHVybiB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5mdW5jdGlvbiByZWxvYWRDb25maWd1cmF0aW9uKCkge1xyXG5cdGxldCBtdGltZSA9IGdldE1UaW1lKGNvbmZpZ1N0YXRlLmZpbGVuYW1lKTtcclxuXHRpZiAoIW10aW1lKSB7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cdGlmIChjb25maWdTdGF0ZS5sYXN0TVRpbWUgJiYgKG10aW1lLmdldFRpbWUoKSA+IGNvbmZpZ1N0YXRlLmxhc3RNVGltZS5nZXRUaW1lKCkpKSB7XHJcblx0XHRjb25maWd1cmVPbmNlT2ZmKGxvYWRDb25maWd1cmF0aW9uRmlsZShjb25maWdTdGF0ZS5maWxlbmFtZSkpO1xyXG5cdH1cclxuXHRjb25maWdTdGF0ZS5sYXN0TVRpbWUgPSBtdGltZTtcclxufTtcclxuXHJcblxyXG5mdW5jdGlvbiBjb25maWd1cmVPbmNlT2ZmKGNvbmZpZzphbnkpIHtcclxuXHRpZiAoY29uZmlnKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRjb25maWd1cmVMZXZlbHMoY29uZmlnLmxldmVscyk7XHJcblx0XHRcdGlmIChjb25maWcucmVwbGFjZUNvbnNvbGUpIHtcclxuXHRcdFx0XHRsb2c0anMucmVwbGFjZUNvbnNvbGUoKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRsb2c0anMucmVzdG9yZUNvbnNvbGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXHJcblx0XHRcdFx0XCJQcm9ibGVtIHJlYWRpbmcgbG9nNGpzIGNvbmZpZyBcIiArIHV0aWwuaW5zcGVjdChjb25maWcpICtcclxuXHRcdFx0XHRcIi4gRXJyb3Igd2FzIFxcXCJcIiArIGUubWVzc2FnZSArIFwiXFxcIiAoXCIgKyBlLnN0YWNrICsgXCIpXCJcclxuXHRcdFx0KTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5mdW5jdGlvbiBjb25maWd1cmVMZXZlbHMobGV2ZWxzOntbaWR4OnN0cmluZ106c3RyaW5nfExldmVsfSkge1xyXG5cdGlmIChsZXZlbHMpIHtcclxuXHRcdGZvciAobGV0IGNhdGVnb3J5IGluIGxldmVscykge1xyXG5cdFx0XHRpZiAobGV2ZWxzLmhhc093blByb3BlcnR5KGNhdGVnb3J5KSkge1xyXG5cdFx0XHRcdGxvZzRqcy5nZXRMb2dnZXIoY2F0ZWdvcnkpLnNldExldmVsKGxldmVsc1tjYXRlZ29yeV0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENvbmZpZ3VyZSB0aGUgbG9nZ2VyLlxyXG4gKiBDb25maWd1cmUgZmlsZSBqdXN0IGxpa2UgbG9nNGpzLmpzb24uIEFuZCBzdXBwb3J0ICR7c2NvcGU6YXJnLW5hbWV9IGZvcm1hdCBwcm9wZXJ0eSBzZXR0aW5nLlxyXG4gKiBJdCBjYW4gcmVwbGFjZSB0aGUgcGxhY2Vob2xkZXIgaW4gcnVudGltZS5cclxuICogc2NvcGUgY2FuIGJlOlxyXG4gKiAgICAgZW52OiBlbnZpcm9ubWVudCB2YXJpYWJsZXMsIHN1Y2ggYXM6IGVudjpQQVRIXHJcbiAqICAgICBhcmdzOiBjb21tYW5kIGxpbmUgYXJndW1lbnRzLCBzdWNoIGFzOiBhcmdzOjFcclxuICogICAgIG9wdHM6IGtleS92YWx1ZSBmcm9tIG9wdHMgYXJndW1lbnQgb2YgY29uZmlndXJlIGZ1bmN0aW9uXHJcbiAqXHJcbiAqIEBwYXJhbSAge1N0cmluZ3xPYmplY3R9IGNvbmZpZyBjb25maWd1cmUgZmlsZSBuYW1lIG9yIGNvbmZpZ3VyZSBvYmplY3RcclxuICogQHBhcmFtICB7T2JqZWN0fSBvcHRzICAgb3B0aW9uc1xyXG4gKiBAcmV0dXJuIHtWb2lkfVxyXG4gKi9cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb25maWd1cmUoY29uZmlnOmFueSwgb3B0cz86YW55KSB7XHJcblx0bGV0IGZpbGVuYW1lID0gY29uZmlnO1xyXG5cdGNvbmZpZyA9IGNvbmZpZyB8fCBwcm9jZXNzLmVudi5MT0c0SlNfQ09ORklHO1xyXG5cdG9wdHMgPSBvcHRzIHx8IHt9O1xyXG5cclxuXHRpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuXHRcdGNvbmZpZyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGNvbmZpZywgXCJ1dGY4XCIpKTtcclxuXHR9XHJcblxyXG5cdGlmIChjb25maWcpIHtcclxuXHRcdGNvbmZpZyA9IHJlcGxhY2VQcm9wZXJ0aWVzKGNvbmZpZywgb3B0cyk7XHJcblx0fVxyXG5cclxuXHRpZiAoY29uZmlnICYmIGNvbmZpZy5saW5lRGVidWcpIHtcclxuXHRcdCg8YW55PnByb2Nlc3MpLmVudi5MT0dHRVJfTElORSA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRpZiAoY29uZmlnICYmIGNvbmZpZy5yYXdNZXNzYWdlKSB7XHJcblx0XHQoPGFueT5wcm9jZXNzKS5lbnYuUkFXX01FU1NBR0UgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0aWYgKGZpbGVuYW1lICYmIGNvbmZpZyAmJiBjb25maWcucmVsb2FkU2Vjcykge1xyXG5cdFx0aW5pdFJlbG9hZENvbmZpZ3VyYXRpb24oZmlsZW5hbWUsIGNvbmZpZy5yZWxvYWRTZWNzKTtcclxuXHR9XHJcblxyXG5cdC8vIGNvbmZpZyBvYmplY3QgY291bGQgbm90IHR1cm4gb24gdGhlIGF1dG8gcmVsb2FkIGNvbmZpZ3VyZSBmaWxlIGluIGxvZzRqc1xyXG5cclxuXHRsb2c0anMuY29uZmlndXJlKGNvbmZpZywgb3B0cyk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiByZXBsYWNlUHJvcGVydGllcyhjb25maWdPYmo6YW55LCBvcHRzPzphbnkpIHtcclxuXHRpZiAoY29uZmlnT2JqIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsID0gY29uZmlnT2JqLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG5cdFx0XHRjb25maWdPYmpbaV0gPSByZXBsYWNlUHJvcGVydGllcyhjb25maWdPYmpbaV0sIG9wdHMpO1xyXG5cdFx0fVxyXG5cdH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZ09iaiA9PT0gJ29iamVjdCcpIHtcclxuXHRcdGxldCBmaWVsZDtcclxuXHRcdGZvciAobGV0IGYgaW4gY29uZmlnT2JqKSB7XHJcblx0XHRcdGlmICghY29uZmlnT2JqLmhhc093blByb3BlcnR5KGYpKSB7XHJcblx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZpZWxkID0gY29uZmlnT2JqW2ZdO1xyXG5cdFx0XHRpZiAodHlwZW9mIGZpZWxkID09PSAnc3RyaW5nJykge1xyXG5cdFx0XHRcdGNvbmZpZ09ialtmXSA9IGRvUmVwbGFjZShmaWVsZCwgb3B0cyk7XHJcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIGZpZWxkID09PSAnb2JqZWN0Jykge1xyXG5cdFx0XHRcdGNvbmZpZ09ialtmXSA9IHJlcGxhY2VQcm9wZXJ0aWVzKGZpZWxkLCBvcHRzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cmV0dXJuIGNvbmZpZ09iajtcclxufVxyXG5cclxuZnVuY3Rpb24gZG9SZXBsYWNlKHNyYzpzdHJpbmcsIG9wdHM/OmFueSkge1xyXG5cdGlmICghc3JjKSB7XHJcblx0XHRyZXR1cm4gc3JjO1xyXG5cdH1cclxuXHJcblx0bGV0IHB0biA9IC9cXCRcXHsoLio/KVxcfS9nO1xyXG5cdGxldCBtLCBwcm8sIHRzLCBzY29wZSwgbmFtZSwgZGVmYXVsdFZhbHVlLCBmdW5jLCByZXMgPSAnJyxcclxuXHRcdGxhc3RJbmRleCA9IDA7XHJcblx0d2hpbGUgKChtID0gcHRuLmV4ZWMoc3JjKSkpIHtcclxuXHRcdHBybyA9IG1bMV07XHJcblx0XHR0cyA9IHByby5zcGxpdCgnOicpO1xyXG5cdFx0aWYgKHRzLmxlbmd0aCAhPT0gMiAmJiB0cy5sZW5ndGggIT09IDMpIHtcclxuXHRcdFx0cmVzICs9IHBybztcclxuXHRcdFx0Y29udGludWU7XHJcblx0XHR9XHJcblxyXG5cdFx0c2NvcGUgPSB0c1swXTtcclxuXHRcdG5hbWUgPSB0c1sxXTtcclxuXHRcdGlmICh0cy5sZW5ndGggPT09IDMpIHtcclxuXHRcdFx0ZGVmYXVsdFZhbHVlID0gdHNbMl07XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuYyA9ICg8YW55PmZ1bmNzKVtzY29wZV07XHJcblx0XHRpZiAoIWZ1bmMgJiYgdHlwZW9mIGZ1bmMgIT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0cmVzICs9IHBybztcclxuXHRcdFx0Y29udGludWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmVzICs9IHNyYy5zdWJzdHJpbmcobGFzdEluZGV4LCBtLmluZGV4KTtcclxuXHRcdGxhc3RJbmRleCA9IHB0bi5sYXN0SW5kZXg7XHJcblx0XHRyZXMgKz0gKGZ1bmMobmFtZSwgb3B0cykgfHwgZGVmYXVsdFZhbHVlKTtcclxuXHR9XHJcblxyXG5cdGlmIChsYXN0SW5kZXggPCBzcmMubGVuZ3RoKSB7XHJcblx0XHRyZXMgKz0gc3JjLnN1YnN0cmluZyhsYXN0SW5kZXgpO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIHJlcztcclxufVxyXG5cclxuZnVuY3Rpb24gZG9FbnYobmFtZTpzdHJpbmcpIHtcclxuXHRyZXR1cm4gcHJvY2Vzcy5lbnZbbmFtZV07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRvQXJncyhuYW1lOm51bWJlcikge1xyXG5cdHJldHVybiBwcm9jZXNzLmFyZ3ZbbmFtZV07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRvT3B0cyhuYW1lOnN0cmluZywgb3B0cz86YW55KSB7XHJcblx0cmV0dXJuIG9wdHMgPyBvcHRzW25hbWVdIDogdW5kZWZpbmVkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRMaW5lKCkge1xyXG5cdGxldCBlID0gbmV3IEVycm9yKCk7XHJcblx0Ly8gbm93IG1hZ2ljIHdpbGwgaGFwcGVuOiBnZXQgbGluZSBudW1iZXIgZnJvbSBjYWxsc3RhY2tcclxuXHRpZihwcm9jZXNzLnBsYXRmb3JtID09PSBcIndpbjMyXCIpIHtcclxuXHRcdHJldHVybiBlLnN0YWNrIS5zcGxpdCgnXFxuJylbM10uc3BsaXQoJzonKVsyXTtcclxuXHR9XHJcblx0cmV0dXJuIGUuc3RhY2shLnNwbGl0KCdcXG4nKVszXS5zcGxpdCgnOicpWzFdO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb2xvcml6ZVN0YXJ0KHN0eWxlOnN0cmluZykge1xyXG5cdHJldHVybiBzdHlsZSA/ICdcXHgxQlsnICsgKDxhbnk+c3R5bGVzKVtzdHlsZV1bMF0gKyAnbScgOiAnJztcclxufVxyXG5cclxuZnVuY3Rpb24gY29sb3JpemVFbmQoc3R5bGU6c3RyaW5nKSB7XHJcblx0cmV0dXJuIHN0eWxlID8gJ1xceDFCWycgKyAoPGFueT5zdHlsZXMpW3N0eWxlXVsxXSArICdtJyA6ICcnO1xyXG59XHJcbi8qKlxyXG4gKiBUYWtlbiBmcm9tIG1hc3lsdW0ncyBmb3JrIChodHRwczovL2dpdGh1Yi5jb20vbWFzeWx1bS9sb2c0anMtbm9kZSlcclxuICovXHJcbmZ1bmN0aW9uIGNvbG9yaXplKHN0cjpzdHJpbmcsIHN0eWxlOnN0cmluZykge1xyXG5cdHJldHVybiBjb2xvcml6ZVN0YXJ0KHN0eWxlKSArIHN0ciArIGNvbG9yaXplRW5kKHN0eWxlKTtcclxufVxyXG5cclxubGV0IHN0eWxlcyA9IHtcclxuXHQvL3N0eWxlc1xyXG5cdCdib2xkJzogWzEsIDIyXSxcclxuXHQnaXRhbGljJzogWzMsIDIzXSxcclxuXHQndW5kZXJsaW5lJzogWzQsIDI0XSxcclxuXHQnaW52ZXJzZSc6IFs3LCAyN10sXHJcblx0Ly9ncmF5c2NhbGVcclxuXHQnd2hpdGUnOiBbMzcsIDM5XSxcclxuXHQnZ3JleSc6IFs5MCwgMzldLFxyXG5cdCdibGFjayc6IFs5MCwgMzldLFxyXG5cdC8vY29sb3JzXHJcblx0J2JsdWUnOiBbMzQsIDM5XSxcclxuXHQnY3lhbic6IFszNiwgMzldLFxyXG5cdCdncmVlbic6IFszMiwgMzldLFxyXG5cdCdtYWdlbnRhJzogWzM1LCAzOV0sXHJcblx0J3JlZCc6IFszMSwgMzldLFxyXG5cdCd5ZWxsb3cnOiBbMzMsIDM5XVxyXG59O1xyXG5cclxubGV0IGNvbG91cnMgPSB7XHJcblx0J2FsbCc6IFwiZ3JleVwiLFxyXG5cdCd0cmFjZSc6IFwiYmx1ZVwiLFxyXG5cdCdkZWJ1Zyc6IFwiY3lhblwiLFxyXG5cdCdpbmZvJzogXCJncmVlblwiLFxyXG5cdCd3YXJuJzogXCJ5ZWxsb3dcIixcclxuXHQnZXJyb3InOiBcInJlZFwiLFxyXG5cdCdmYXRhbCc6IFwibWFnZW50YVwiLFxyXG5cdCdvZmYnOiBcImdyZXlcIlxyXG59O1xyXG5cclxuZXhwb3J0ICogZnJvbSAnbG9nNGpzJztcclxuXHJcbi8qXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cdGdldExvZ2dlcjogZ2V0TG9nZ2VyLFxyXG5cdGdldERlZmF1bHRMb2dnZXI6IGxvZzRqcy5nZXREZWZhdWx0TG9nZ2VyLFxyXG5cclxuXHRhZGRBcHBlbmRlcjogbG9nNGpzLmFkZEFwcGVuZGVyLFxyXG5cdGxvYWRBcHBlbmRlcjogbG9nNGpzLmxvYWRBcHBlbmRlcixcclxuXHRjbGVhckFwcGVuZGVyczogbG9nNGpzLmNsZWFyQXBwZW5kZXJzLFxyXG5cdGNvbmZpZ3VyZTogY29uZmlndXJlLFxyXG5cclxuXHRyZXBsYWNlQ29uc29sZTogbG9nNGpzLnJlcGxhY2VDb25zb2xlLFxyXG5cdHJlc3RvcmVDb25zb2xlOiBsb2c0anMucmVzdG9yZUNvbnNvbGUsXHJcblxyXG5cdGxldmVsczogbG9nNGpzLmxldmVscyxcclxuXHRzZXRHbG9iYWxMb2dMZXZlbDogbG9nNGpzLnNldEdsb2JhbExvZ0xldmVsLFxyXG5cclxuXHRsYXlvdXRzOiBsb2c0anMubGF5b3V0cyxcclxuXHRhcHBlbmRlcnM6IGxvZzRqcy5hcHBlbmRlcnNcclxufTtcclxuKi8iXX0=